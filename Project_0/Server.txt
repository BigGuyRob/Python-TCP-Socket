import argparse

from sys import argv
import socket

parser = argparse.ArgumentParser(description="""This is a very basic program""")
parser.add_argument('port', type=int, help='This is the port to listen for the client on', action='store')
args = parser.parse_args(argv[1:])

HOST = socket.gethostbyname('localhost')
PORT = args.port

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.bind((HOST,PORT))
print(f'bound {HOST}')
print(f'to {PORT}')
sock.listen()
conn,addr = sock.accept()
data = conn.recv(1024)
while(data):
    answer = data.decode('utf-8')
    answer = answer[::-1]
    encoded = answer.encode('utf-8')
    conn.sendall(encoded)
    data = conn.recv(1024)
sock.close()
    # 1024 is the max bytes that can be recieved at one time
